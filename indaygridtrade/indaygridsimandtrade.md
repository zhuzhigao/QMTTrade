# 📘 金阳光 QMT 策略说明书：日内深跌抄底与动态止盈策略 (V2)

**文档版本**：2.0
**适用平台**：光大证券金阳光 QMT (迅投研)
**策略类型**：日内反转 + 波段持有 (Reversal & Trend Following)

---

## 1. 策略核心理念

本策略的核心逻辑基于 **“均值回归”** 与 **“趋势跟随”** 的结合。
* **买入端**：寻找市场中的非理性恐慌抛售（超跌），博取短期的暴力反弹。
* **卖出端**：一旦买入成功，不急于离场，而是利用 ATR（平均真实波幅）动态调整止盈线，尽可能让利润奔跑，同时严格限制回撤。

---

## 2. 深度解析：交易逻辑 (Trading Logic)

### 🟢 买入逻辑：如何在“绝望”中寻找机会？

策略并不会因为股票跌了就无脑买，它设置了 **四重过滤网**，必须同时穿透才能触发下单。

#### 第一网：大盘安全阀 (Benchmark Filter)
> *"大河有水小河满，大河干涸小河干。"*
* **逻辑**：在系统性风险爆发（如大盘暴跌）时，个股的深跌往往是崩盘的开始，而非抄底机会。
* **代码行为**：程序每 3 秒检查一次基准指数（如上证指数）。
* **判定**：如果大盘跌幅超过 `BENCHMARK_RISK_THRESH` (默认 -2.5%)，**全天停止开新仓**。

#### 第二网：深跌阈值 (Deep Dip)
* **逻辑**：寻找被主力错杀或情绪恐慌导致的暴跌股。
* **判定**：个股当前价格较昨日收盘价跌幅超过 `BUY_DIP_PCT` (默认 -6%)。

#### 第三网：右侧确认 (Rebound Confirmation) —— *核心亮点*
> *"不接飞刀，只接落地反弹的球。"*
* **逻辑**：股票跌到 -6% 时可能还会继续跌到 -10%（跌停）。为了防止买在半山腰，我们要求股价必须从今日的最低点出现“钩头向上”的迹象。
* **判定**：计算公式 `(当前价 - 今日最低价) / 今日最低价 >= REBOUND_PCT` (默认 0.5%)。
    * *场景模拟*：某股一路杀跌至 10.00 元（最低点），策略观望。当股价反弹至 10.05 元时，确认企稳，触发买入。

#### 第四网：资金风控 (Risk Control)
* **判定**：
    1.  单只股票持仓占比未超过 `SINGLE_STOCK_LIMIT_PCT` (默认 30%)。
    2.  当日总买入金额未超过 `MAX_DAILY_BUY_AMOUNT` (默认 10万)。

---

### 🔴 卖出逻辑：止盈不止损的艺术

卖出信号分为 **“硬性防守”** 和 **“动态防守”** 两大类。

#### 1. 硬性止盈/止损 (Hard Limits)
这是策略的底线，优先于所有逻辑执行。
* **大赚离场**：持仓收益 > `HOLD_PROFIT_PCT` (默认 +20%) -> **清仓**。
* **认赔出局**：持仓亏损 < `HOLD_LOSS_PCT` (默认 -15%) -> **清仓**（活着最重要）。

#### 2. 日内移动止盈 (Trailing Stop)
这是策略获取超额收益的关键。
* **逻辑**：如果股票在日内快速拉升，我们不猜顶，而是跟随价格上移止盈线。
* **判定**：
    1.  程序记录该股票自买入（或今日开盘）以来的 **最高价**。
    2.  如果 `(最高价 - 当前价) / 最高价` 超过 `TRAILING_DRAWDOWN` (默认 0.5%)，说明冲高乏力，触发卖出。
    * *场景模拟*：股票买入后涨了 5%，随后回落到 4.5%。策略认为上涨势头结束，锁定 4.5% 的利润离场。

#### 3. ATR 波动率止损 (ATR Stop)
* **逻辑**：利用 ATR 指标计算股票的“正常心跳范围”。
* **判定**：如果股价跌破了基于 ATR 计算的动态支撑位，说明股价波动异常（心跳骤停或过快），为了安全起见，先行离场观望。

---

## 3. 配置文件指南 (`siminput.csv`)

在 **模拟模式 (SIMULATION = True)** 下，你需要手动配置初始持仓文件。

### 文件规范
* **文件名**：`siminput.csv`
* **位置**：必须与策略脚本 `indaygridsimandtrade.py` 在同一文件夹。
* **编码**：建议使用 `UTF-8` 或 `CSV (逗号分隔)`。
### 内容模板
你可以直接复制以下内容到 Excel 或记事本中保存：

stock_code,cost,volume
600519.SH,1700.50,100
000001.SZ,10.20,2000


## 4. 关键参数与风格推荐

根据你的风险偏好和当前市场环境，推荐三套参数配置：

| 参数变量名 | 含义 | 默认值 | 🦁 激进型<br>(牛市/高波) | 🐻 稳健型<br>(震荡市/平衡) | 🐢 保守型<br>(熊市/防御) |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **抄底参数** | | | | | |
| `BUY_DIP_PCT` | **深跌买入阈值**<br>跌多少才买？ | **-0.06**<br>(-6%) | **-0.04**<br>(-4%) | **-0.06**<br>(-6%) | **-0.08**<br>(-8%) |
| `REBOUND_PCT` | **反弹确认幅度**<br>反弹多少确认企稳？ | **0.005**<br>(0.5%) | **0.003**<br>(0.3%) | **0.005**<br>(0.5%) | **0.008**<br>(0.8%) |
| **持仓管理** | | | | | |
| `HOLD_PROFIT_PCT`| **硬性止盈**<br>赚多少离场？ | **0.20**<br>(20%) | **0.30**<br>(30%) | **0.20**<br>(20%) | **0.10**<br>(10%) |
| `HOLD_LOSS_PCT` | **硬性止损**<br>亏多少认输？ | **-0.15**<br>(-15%)| **-0.20**<br>(-20%)| **-0.15**<br>(-15%)| **-0.08**<br>(-8%) |
| `TRAILING_DRAWDOWN`| **移动止盈回撤**<br>冲高回落多少卖？ | **0.005**<br>(0.5%) | **0.01**<br>(1.0%) | **0.005**<br>(0.5%) | **0.003**<br>(0.3%) |
| **风控与波动** | | | | | |
| `ATR_MULTIPLIER` | **波动率倍数**<br>容忍多大的震荡？ | **2.0** | **3.0** | **2.0** | **1.5** |
| `SINGLE_STOCK_LIMIT_PCT`| **单股持仓上限** | **0.30**<br>(30%) | **0.50**<br>(50%) | **0.30**<br>(30%) | **0.20**<br>(20%) |

### 💡 参数调整思路

* **🦁 激进型**：
    * **适用场景**：市场情绪高涨、普涨行情。
    * **逻辑**：牛市中股票很难跌到 -6%，所以把买入阈值上调到 **-4%** 以免踏空；同时放大止盈预期，敢于持仓。

* **🐻 稳健型**：
    * **适用场景**：当前 A 股的大部分震荡行情。
    * **逻辑**：平衡了胜率和盈亏比，默认参数即为此配置。

* **🐢 保守型**：
    * **适用场景**：单边下跌市、熊市。
    * **逻辑**：只做极端错杀（**-8%**），并且反弹确认要求更高（**0.8%**），防止接飞刀；一旦有一点利润（**10%**）就落袋为安，绝不恋战。